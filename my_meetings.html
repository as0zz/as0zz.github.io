<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Å—Ç—Ä–µ—á–∏ | IT-–ú–µ–Ω—Ç–æ—Ä</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #4F46E5; --bg: #F3F4F6; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; color: #111827; }

        header { background: white; padding: 1rem 5%; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 800; color: var(--primary); text-decoration: none; }

        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
        .page-header { margin-bottom: 2rem; }

        .meeting-card {
            background: white; border-radius: 12px; padding: 1.5rem; border: 1px solid #E5E7EB;
            margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;
        }
        .m-info h3 { margin: 0 0 0.5rem 0; font-size: 1.1rem; color: var(--primary); }
        .m-details { font-size: 0.85rem; color: #6B7280; display: flex; gap: 15px; }
        .m-mentor { font-weight: 600; color: #374151; }

        .btn-book {
            background: var(--primary); color: white; border: none; padding: 0.6rem 1.2rem;
            border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn-book:disabled { background: #10B981; cursor: default; } /* –ó–µ–ª–µ–Ω—ã–π, –µ—Å–ª–∏ —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω */
        .btn-delete { background: #FEE2E2; color: #B91C1C; border: none; padding: 0.6rem; border-radius: 8px; cursor: pointer; }

        .badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; font-weight: 700; text-transform: uppercase; }
        .badge-webinar { background: #EEF2FF; color: #4338CA; }
        .badge-private { background: #ECFDF5; color: #065F46; }

        .empty-state { text-align: center; padding: 4rem 2rem; background: white; border-radius: 12px; border: 2px dashed #D1D5DB; }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo">‚ö° IT-Mentor</a>
        <a href="#" id="back-link" style="text-decoration:none; color:#4B5563; font-size:0.9rem;">‚Üê –í –∫–∞–±–∏–Ω–µ—Ç</a>
    </header>

    <div class="container">
        <div class="page-header">
            <h1 id="page-title">–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏</h1>
            <p id="page-desc">–ù–∞–π–¥–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –º–µ—Å—Ç–æ.</p>
        </div>

        <div id="meetings-container">
            </div>
    </div>

    <script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const allMeetings = JSON.parse(localStorage.getItem('all_meetings')) || [];

        if (!currentUser) window.location.href = 'login.html';

        document.getElementById('back-link').href = currentUser.role === 'mentor' ? 'dashboard_mentor.html' : 'dashboard_student.html';

        function renderMeetings() {
            const container = document.getElementById('meetings-container');
            container.innerHTML = '';

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –ú–µ–Ω—Ç–æ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏, –°—Ç—É–¥–µ–Ω—Ç ‚Äî –≤—Å–µ
            const meetingsToShow = currentUser.role === 'mentor'
                ? allMeetings.filter(m => m.mentorId === currentUser.id)
                : allMeetings;

            if (currentUser.role === 'mentor') {
                document.getElementById('page-title').textContent = '–ú–æ–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è';
                document.getElementById('page-desc').textContent = '–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –≤–æ—Ä–∫—à–æ–ø–∞–º–∏ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.';
            }

            if (meetingsToShow.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á.</p>
                        ${currentUser.role === 'mentor' ? '<a href="create_meeting.html" style="color:var(--primary)">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é?</a>' : ''}
                    </div>`;
                return;
            }

            meetingsToShow.forEach(m => {
                const isSignedUp = m.participants.includes(currentUser.id);
                const card = document.createElement('div');
                card.className = 'meeting-card';

                card.innerHTML = `
                    <div class="m-info">
                        <span class="badge badge-${m.type}">${m.type}</span>
                        <h3>${m.title}</h3>
                        <div class="m-details">
                            <span>üìÖ ${m.date}</span>
                            <span>‚è∞ ${m.time}</span>
                            <span class="m-mentor">üë§ ${m.mentorName}</span>
                        </div>
                    </div>
                    <div class="m-actions">
                        ${currentUser.role === 'student' ? `
                            <button class="btn-book" ${isSignedUp ? 'disabled' : ''} onclick="signUp(${m.id})">
                                ${isSignedUp ? '‚úì –í—ã –∑–∞–ø–∏—Å–∞–Ω—ã' : '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è'}
                            </button>
                        ` : `
                            <div style="text-align:right">
                                <small style="display:block; margin-bottom:5px; color:#6B7280">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${m.participants.length}</small>
                                <button class="btn-delete" onclick="deleteMeeting(${m.id})">üóë –£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        `}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // –õ–æ–≥–∏–∫–∞ –∑–∞–ø–∏—Å–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
        function signUp(meetingId) {
            const meetings = JSON.parse(localStorage.getItem('all_meetings'));
            const meeting = meetings.find(m => m.id === meetingId);

            if (!meeting.participants.includes(currentUser.id)) {
                meeting.participants.push(currentUser.id);
                localStorage.setItem('all_meetings', JSON.stringify(meetings));
                alert('–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –≤—Å—Ç—Ä–µ—á—É!');
                renderMeetings();
            }
        }

        // –õ–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏ (–¥–ª—è –º–µ–Ω—Ç–æ—Ä–∞)
        function deleteMeeting(meetingId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?')) {
                const meetings = JSON.parse(localStorage.getItem('all_meetings'));
                const filtered = meetings.filter(m => m.id !== meetingId);
                localStorage.setItem('all_meetings', JSON.stringify(filtered));
                location.reload();
            }
        }

        renderMeetings();
    </script>
</body>
</html>